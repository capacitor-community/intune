<?xml version="1.0" encoding="UTF-8"?>
<plugin xmlns="http://apache.org/cordova/ns/plugins/1.0" id="@ionic-enterprise/intune" version="1.2.2">
    <name>@ionic-enterprise/intune</name>
    <description>Ionic Intune Plugin</description>
    <license>SEE LICENSE</license>
    <keywords>Ionic,msal,intune</keywords>
    <repo>git+https://github.com/ionic-team/enterprise-intune.git</repo>
    <issue>https://ionic.zendesk.com/hc/en-us</issue>

    <preference name="INTUNE_SIGNATURE_HASH" />

    <js-module src="cordova/www/ionicintune.js" name="ionicintune">
        <runs/>
        <clobbers target="IntuneMAM"/>
    </js-module>
    <platform name="android">
      <hook type="after_plugin_install" src="scripts/cordovaAndroidAfterPluginInstall.js" />
        <config-file target="res/xml/config.xml" parent="/*">
            <feature name="IntuneMAM">
                <param name="android-package" value="com.ionicframework.intune.IntunePlugin"/>
                <param name="onload" value="true"/>
            </feature>
        </config-file>
        <edit-config file="AndroidManifest.xml" target="/manifest/application" mode="merge">
            <application android:name="com.ionicframework.intune.IntuneApplication" />
        </edit-config>
        <config-file target="AndroidManifest.xml" parent="/manifest">
            <queries>
                <package android:name="com.azure.authenticator" />
                <package android:name="$PACKAGE_NAME" />
                <package android:name="com.microsoft.windowsintune.companyportal" />
                <intent>
                    <action android:name="android.intent.action.VIEW" />
                    <category android:name="android.intent.category.BROWSABLE" />
                    <data android:scheme="https" />
                </intent>
                <intent>
                    <action android:name="android.support.customtabs.action.CustomTabsService" />
                </intent>
            </queries>
        </config-file>
        <config-file target="AndroidManifest.xml" parent="/manifest/application">
            <activity android:name="com.microsoft.identity.client.BrowserTabActivity">
                <intent-filter>
                    <action android:name="android.intent.action.VIEW" />

                    <category android:name="android.intent.category.DEFAULT" />
                    <category android:name="android.intent.category.BROWSABLE" />

                    <data
                        android:host="$PACKAGE_NAME"
                        android:path="/$INTUNE_SIGNATURE_HASH"
                        android:scheme="msauth" />
                </intent-filter>
            </activity>
        </config-file>

        <framework src="cordova/src/android/ionicintune.gradle" custom="true" type="gradleReference" />

        <resource-file src="android/ms-intune-app-sdk-android/Microsoft.Intune.MAM.SDK.aar" target="libs/Microsoft.Intune.MAM.SDK.aar" />
        <resource-file src="android/ms-intune-app-sdk-android/GradlePlugin/com.microsoft.intune.mam.build.jar" target="libs/com.microsoft.intune.mam.build.jar" />
        
        <!--
        <resource-file src="android/capacitor-cordova-compat.aar" target="libs/capacitor-cordova-compat.aar" />
        -->

        <!-- Cordova plugin entry point -->
        <!--
        <source-file src="cordova/src/android/com/ionicframework/intune/IntuneCordovaPlugin.java" target-dir="src/com/ionicframework/intune"/>
        -->

        <!-- from Capacitor -->
        <source-file src="android/src/main/java/com/ionicframework/intune/IntunePlugin.java" target-dir="src/com/ionicframework/intune"/>
        <source-file src="android/src/main/java/com/ionicframework/intune/AppAccount.java" target-dir="src/com/ionicframework/intune"/>
        <source-file src="android/src/main/java/com/ionicframework/intune/AuthCallback.java" target-dir="src/com/ionicframework/intune"/>
        <source-file src="android/src/main/java/com/ionicframework/intune/AuthenticationCallback.java" target-dir="src/com/ionicframework/intune"/>
        <source-file src="android/src/main/java/com/ionicframework/intune/IntuneApplication.java" target-dir="src/com/ionicframework/intune"/>
        <source-file src="android/src/main/java/com/ionicframework/intune/MSALUtil.java" target-dir="src/com/ionicframework/intune"/>

        <source-file src="cordova/src/android/com/getcapacitor/Bridge.java" target-dir="src/com/getcapacitor" />
        <source-file src="cordova/src/android/com/getcapacitor/JSArray.java" target-dir="src/com/getcapacitor" />
        <source-file src="cordova/src/android/com/getcapacitor/JSObject.java" target-dir="src/com/getcapacitor" />
        <source-file src="cordova/src/android/com/getcapacitor/Logger.java" target-dir="src/com/getcapacitor" />
        <source-file src="cordova/src/android/com/getcapacitor/Plugin.java" target-dir="src/com/getcapacitor" />
        <source-file src="cordova/src/android/com/getcapacitor/PluginCall.java" target-dir="src/com/getcapacitor" />
        <source-file src="cordova/src/android/com/getcapacitor/PluginHandle.java" target-dir="src/com/getcapacitor" />
        <source-file src="cordova/src/android/com/getcapacitor/PluginMethod.java" target-dir="src/com/getcapacitor" />
        <source-file src="cordova/src/android/com/getcapacitor/PluginMethodHandle.java" target-dir="src/com/getcapacitor" />
        <source-file src="cordova/src/android/com/getcapacitor/annotation/CapacitorPlugin.java" target-dir="src/com/getcapacitor/annotation" />
        <source-file src="cordova/src/android/com/getcapacitor/annotation/Permission.java" target-dir="src/com/getcapacitor/annotation" />
        <source-file src="cordova/src/android/com/getcapacitor/util/PermissionHelper.java" target-dir="src/com/getcapacitor/util" />
    </platform>
    <!-- ios -->
    <platform name="ios">
        <preference name="INTUNE_CLIENT_ID" />
        <preference name="INTUNE_ADAL_AUTHORITY" />
        <preference name="INTUNE_REDIRECT_URI_IOS" />

        <config-file target="config.xml" parent="/*">
            <feature name="IntuneMAM">
                <param name="ios-package" value="IntuneMAM" onload="true"/>
            </feature>
        </config-file>
        <config-file target="*-Info.plist" parent="NSFaceIDUsageDescription">
            <string>Use Face ID to authenticate yourself and login</string>
        </config-file>
        <config-file target="*-Info.plist" parent="CFBundleURLTypes">
        	<array>
            <dict>
              <key>CFBundleURLSchemes</key>
              <array>
                <string>msauth.$(PRODUCT_BUNDLE_IDENTIFIER)</string>
                <string>msauth.$(PRODUCT_BUNDLE_IDENTIFIER)-intunemam</string>
                <string>msauth.com.microsoft.intunemam</string>
              </array>
            </dict>
          </array>
        </config-file>
        <config-file target="*-Info.plist" parent="LSApplicationQueriesSchemes">
          <array>
            <string>mvisionmobile</string>
            <string>msauthv2</string>
            <string>scmx</string>
            <string>lookoutwork-ase</string>
            <string>msauthv3</string>
            <string>lacoonsecurity</string>
            <string>zips</string>
            <string>skycure</string>
            <string>smart-ns</string>
            <string>smsec</string>
            <string>betteractiveshield</string>
            <string>companyportal</string>
            <string>wandera</string>
            <string>https-intunemam</string>
            <string>http-intunemam</string>
            <string>microsoft-edge-https-intunemam</string>
            <string>microsoft-edge-http-intunemam</string>
            <string>ms-outlook-intunemam</string>
          </array>
        </config-file>
        <config-file target="*-Info.plist" parent="IntuneMAMSettings">
          <dict>
            <key>ADALClientId</key>
            <string>$INTUNE_CLIENT_ID</string>
            <key>ADALAuthority</key>
            <string>$INTUNE_ADAL_AUTHORITY</string>
            <key>ADALRedirectUri</key>
            <string>$INTUNE_REDIRECT_URI_IOS</string>
          </dict>
        </config-file>

        <config-file target="*/Entitlements-Release.plist" parent="keychain-access-groups">
          <array>
            <string>$(AppIdentifierPrefix)$PACKAGE_NAME</string>
            <string>$(AppIdentifierPrefix)com.microsoft.intune.mam</string>
            <string>$(AppIdentifierPrefix)com.microsoft.adalcache</string>
          </array>
        </config-file>

        <config-file target="*/Entitlements-Debug.plist" parent="keychain-access-groups">
          <array>
            <string>$(AppIdentifierPrefix)$PACKAGE_NAME</string>
            <string>$(AppIdentifierPrefix)com.microsoft.intune.mam</string>
            <string>$(AppIdentifierPrefix)com.microsoft.adalcache</string>
          </array>
        </config-file>

        <framework src="ios/IntuneMAMSwift.xcframework" custom="true" embed="true" />
        <framework src="ios/IntuneMAMSwiftStub.xcframework" custom="true" embed="true" />
        <framework src="ios/MSAL.xcframework" custom="true" embed="true" />

        <framework src="AudioToolbox.framework" />
        <framework src="CoreServices.framework" />
        <framework src="ImageIO.framework" />
        <framework src="libc++.tbd" />
        <framework src="libsqlite3.tbd" />
        <framework src="LocalAuthentication.framework" />
        <framework src="MessageUI.framework" />
        <framework src="QuartzCore.framework" />
        <framework src="Security.framework" />
        <framework src="SystemConfiguration.framework" />
        <framework src="WebKit.framework" />

        <header-file src="cordova/src/ios/AppDelegate+IntuneMAM.h" />
        <source-file src="cordova/src/ios/AppDelegate+IntuneMAM.m" />
        <source-file src="ios/Plugin/EnrollmentDelegate.swift"/>
        <source-file src="ios/Plugin/PolicyDelegate.swift"/>

        <source-file src="cordova/src/ios/IntunePlugin.swift"/>
        <header-file src="cordova/src/ios/CAPPlugin.h" type="BridgingHeader" />
        <source-file src="cordova/src/ios/CAPPlugin.m"/>
        <header-file src="cordova/src/ios/CAPPluginCall.h" type="BridgingHeader" />
        <source-file src="cordova/src/ios/CAPPluginCall.m"/>
        <source-file src="cordova/src/ios/CAPPluginCall.swift"/>
    </platform>
    <author email="hi@ionic.io" href="https://ionicframework.com">Ionic Team</author>
</plugin>
